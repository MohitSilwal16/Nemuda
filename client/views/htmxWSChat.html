<!DOCTYPE html>
<div
  id="chat-body"
  class="flex w-screen h-screen px-10 py-5 overflow-hidden text-white bg-gray-500"
>
  <head>
    <title>Nemuda</title>
    <script src="./static/js/htmx.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      type="image/x-icon"
      href="../../static/images/favico.svg"
    />

    <!-- <link rel="stylesheet" href="./static/css/output.css" /> -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Extension to send data in JSON Format using hx-ext="json-enc" -->
    <script src="./static/js/json-enc.js"></script>
    <!-- Websocket -->
    <script src="./static/js/ws.js"></script>
  </head>

  <!-- Recent Chats & Search -->
  <div class="w-1/3">
    <!-- Nemu, home & logout -->
    <div class="flex">
      <div class="py-6 text-2xl cursor-pointer">Nemu</div>
      <div class="w-full"></div>
      <button
        class="px-8 m-4 text-xl font-normal bg-blue-700 rounded-md hover:bg-blue-800"
        hx-get="/blogs/All?offset=0"
        hx-target="#chat-body"
        hx-swap="outerHTML"
      >
        Home
      </button>
      <button
        class="px-5 m-4 text-xl font-normal bg-blue-700 rounded-md w-96 hover:bg-blue-800"
        hx-delete="/login"
        hx-target="#chat-body"
        hx-swap="outerHTML"
      >
        Log Out
      </button>
    </div>

    <!-- Search Recent Chats -->
    <div class="relative border-2 border-white rounded-xl">
      <input
        id="search"
        type="text"
        class="w-full py-2 pl-12 rounded-xl text-md"
        placeholder="Search"
      />
      <img
        src="./static/images/search.png"
        class="absolute h-6 top-2.5 left-3 cursor-text"
        onclick="search.focus()"
      />
    </div>

    <!-- Recent Chats -->
    <div class="h-full mt-5 mb-32 overflow-y-auto scroll-bar">
      <div
        class="h-20 mb-5 bg-slate-600"
        hx-get="/message/Nimesh"
        hx-target="#chat-body"
        hx-swap="outerHTML"
      >
        Nimesh
      </div>
      <div
        class="h-20 mb-5 bg-slate-600"
        hx-get="/message/Konark"
        hx-target="#chat-body"
        hx-swap="outerHTML"
      >
        Konark
      </div>
      <div
        class="h-20 mb-5 bg-slate-600"
        hx-get="/message/Aayush"
        hx-target="#chat-body"
        hx-swap="outerHTML"
      >
        Aayush
      </div>
      <div
        class="h-20 mb-5 bg-slate-600"
        hx-get="/message/Palash"
        hx-target="#chat-body"
        hx-swap="outerHTML"
      >
        Palash
      </div>
      <div
        class="h-20 mb-5 bg-slate-600"
        hx-get="/message/Parth"
        hx-target="#chat-body"
        hx-swap="outerHTML"
      >
        Parth
      </div>
      <div
        class="h-20 mb-5 bg-slate-600"
        hx-get="/message/Prachin"
        hx-target="#chat-body"
        hx-swap="outerHTML"
      >
        Prachin
      </div>
      <div
        class="h-20 mb-5 bg-slate-600"
        hx-get="/message/Robin"
        hx-target="#chat-body"
        hx-swap="outerHTML"
      >
        Robin
      </div>
      <div class="h-20 mb-5 bg-slate-600">Nimesh</div>
      <div class="h-20 mb-5 bg-slate-600">Nimesh</div>
      <div class="h-20 mb-5 bg-slate-600">Nimesh</div>
      <div class="h-20 mb-5 bg-slate-600">Nimesh</div>
      <div class="h-20 mb-5 bg-slate-600">Nimesh</div>
      <div class="h-20 mb-5 bg-slate-600">Nimesh</div>
    </div>
  </div>

  <!-- Message Page -->
  <div
    class="w-2/3"
    id="ws"
    hx-ext="ws"
    ws-connect="ws://localhost:3000/ws/chat"
  >
    <div
      class="flex items-center justify-center mt-5 bg-blue-400 h-14"
      id="title"
    >
      {{ .Receiver }}
    </div>

    <!-- Messages -->
    <div
      id="messages"
      class="p-10 mt-3 overflow-y-auto border border-white rounded-lg h-5/6 scroll-bar"
    >
      {{ if eq .Receiver "Nemu Chat" }}
      <p class="text-3xl text-center text-white">Welcome to Nemu Chat</p>
      {{ else if not .Messages }}
      <div class="p-8 text-center shadow-lg rounded-xl" id="noMsgBox">
        <p class="text-3xl text-white">
          No Messages with
          <span class="font-bold">{{ $.Receiver }}</span>
        </p>
      </div>
      {{ end }} {{ range .Messages }} {{ if eq .Sender $.Receiver }}
      <p class="text-white">
        {{ .Sender }}: {{ .MessageContent }} "{{ .DateTime }}" {{ .Status }}
      </p>
      {{ else }}
      <p class="text-right text-white">
        {{ .Sender }}: {{ .MessageContent }} "{{ .DateTime }}" {{ .Status }}
      </p>
      {{ end }} {{ end }}
    </div>

    <div class="w-full h-16 mt-5 ml-4 bottom-1">
      <div class="relative w-full h-full">
        <!-- Textfield -->
        <form id="form" ws-send hx-trigger="submit">
          <input
            readonly
            autofocus
            type="text"
            name="message"
            id="message"
            class="w-full h-full px-2 py-4 text-xl border-2 border-white rounded-xl"
            placeholder="Enter message ..."
            id="textfieldMessage"
          />
          <input
            type="text"
            name="receiver"
            id="receiver"
            value="{{ .Receiver }}"
            class="hidden"
          />

          <!-- Send button -->
          <button type="submit" class="absolute h-5 right-5 bottom-6">
            <img
              src="./static/images/send-message.png"
              alt=""
              class="h-5 right-5 bottom-6"
            />
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Pop-up Alert Box -->
  <div
    class="fixed inset-0 z-50 items-center justify-center hidden bg-black bg-opacity-50"
    id="overlay"
  >
    <div class="max-w-sm p-6 mx-auto bg-white rounded-lg shadow-lg">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold text-gray-800">Alert</h2>
        <button
          class="text-gray-500 hover:text-gray-700 focus:outline-none"
          onclick="closeAlert()"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            ></path>
          </svg>
        </button>
      </div>
      <p class="mt-4 text-gray-600">This is an alert box</p>
      <div class="flex justify-end mt-6">
        <button
          class="px-4 py-2 text-white bg-blue-600 rounded hover:bg-blue-700 focus:outline-none"
          onclick="closeAlert()"
        >
          Close
        </button>
      </div>
    </div>
  </div>

  <div class="" id="output"></div>

  <script>
    function clearMessageField() {
      document.getElementById("message").value = "";
    }

    var outputDiv = document.getElementById("output");

    document.body.addEventListener("htmx:wsAfterMessage", function () {
      var lastChild = outputDiv.lastElementChild;
      console.log("Hello");
      alert("Hi");
      alert(lastChild);
      alert(lastChild.innerText);
      alert(lastChild.innerHTML);
    });

    // document.body.addEventListener("change", function () {
    // var noMsgBox = document.getElementById("noMsgBox");
    // console.log("Hello");
    // console.log(noMsgBox.nextSibling);
    // console.log(noMsgBox.nextElementSibling);
    // if (noMsgBox.nextElementSibling) {
    //   noMsgBox.classList += "hidden";
    //   console.log("Done");
    // } else if (noMsgBox.nextElementSibling) {
    //   noMsgBox.classList += "hidden";
    //   console.log("Done 1");
    // }
    // console.log(noMsgBox.classList);
    // });

    document.getElementById("form").addEventListener("submit", function (evt) {
      setTimeout(clearMessageField, 100); // Delay to ensure the message is sent before clearing
    });

    var title = document.getElementById("title");

    if (title.innerText != "Nemu Chat") {
      document.getElementById("message").removeAttribute("readonly");
    }

    // Function to open the alert box
    // function openAlert() {
    //   document.getElementById("overlay").style.display = "flex";
    // }

    // // Function to close the alert box
    // function closeAlert() {
    //   document.getElementById("overlay").style.display = "none";
    // }

    // // Event listener to open alert box when title is clicked
    // document.getElementById("title").addEventListener("click", function () {
    //   openAlert();
    // });
  </script>
</div>
